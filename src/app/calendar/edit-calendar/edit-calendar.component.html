<div class="form-content">
  <form [formGroup]="calendarForm" #formDirective="ngForm" (ngSubmit)='onSubmitForm(form,formDirective)'>

    <div class="form-calendar">
      <div class="form-calendar-header">
        <p>Заполните календарь игр</p>
      </div>
      <div class="form-calendar-body">

        <mat-accordion class="calendar-headers-align">
          <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Дата и время проведения матча
              </mat-panel-title>
              <mat-panel-description>
                Выберите дату и время проведения матч
                <mat-icon>date_range</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div formGroupName="calendarData">
              <!-- Форма выбора даты -->
              <mat-form-field class="date-match">
                <input matInput [matDatepicker]="picker" (dateChange)="compareDate()" formControlName='date'
                  placeholder="Выберите дату игры">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>

              <!-- Форма выбора времени -->
              <app-time-picker (inputTimeChange)="updateTime($event)" [inputTime]="inputTime"></app-time-picker>
              <br>

            </div>
            <mat-action-row>
              <button mat-button color="primary" type="button" (click)="nextStep()">Next</button>
            </mat-action-row>
          </mat-expansion-panel>

          <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Состав команды
              </mat-panel-title>
              <mat-panel-description>
                Выберите состав команды
                <mat-icon>people</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div formGroupName="compositionData">
              <mat-form-field style="width: 320px">
                <mat-label>Команда</mat-label>
                <mat-select [disabled]="isDisabledSelect()" (selectionChange)="changeTeamType($event)"
                  formControlName='teamType'>
                  <mat-option *ngFor="let teamType of teamTypes" [value]="teamType">
                    {{teamType.viewValue}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <ng-container *ngIf="selectedTeamType.value == 'main'">

                <div class="main-team-all-purpose">
                  <h3>Универсалы</h3>
                  <div class="players-content">
                    <ng-container class="main-team-checkbox" *ngFor="let player of players">
                      <ng-container *ngIf="player.teamType.value=='main' && player.role.value=='all-purpose'">
                        <mat-checkbox [disabled]="isDisabledAllPurpose(player)" [checked]="isPlayerChecked(player)"
                          [id]="player.id" (change)="onChange($event,player)">
                          {{player.name}} {{player.surname}}</mat-checkbox>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
                <div class="main-team-goalkeepers">
                  <h3>Голкиперы</h3>
                  <div class="players-content">
                    <ng-container class="main-team-checkbox" *ngFor="let player of players">
                      <ng-container *ngIf="player.teamType.value=='main' && player.role.value=='goalkeeper'">
                        <mat-checkbox [disabled]="isDisabledGoalkeepers(player)" [checked]="isPlayerChecked(player)"
                          [id]="player.id" (change)="onChange($event,player)">
                          {{player.name}} {{player.surname}}</mat-checkbox>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
              <ng-container *ngIf="selectedTeamType.value =='d'">
                <div class="d-team-all-purpose">
                  <h3>Универсалы</h3>
                  <div class="players-content">
                    <ng-container class="d-team-checkbox" *ngFor="let player of players">
                      <ng-container *ngIf="player.teamType.value=='d' && player.role.value=='all-purpose'">
                        <mat-checkbox [disabled]="isDisabledAllPurpose(player)" [checked]="isPlayerChecked(player)"
                          [id]="player.id" (change)="onChange($event,player)">
                          {{player.name}} {{player.surname}}</mat-checkbox>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
                <div class="d-team-goalkeepers">
                  <h3>Голкиперы</h3>
                  <div class="players-content">
                    <ng-container class="d-team-checkbox" *ngFor="let player of players">
                      <ng-container *ngIf="player.teamType.value=='d' && player.role.value=='goalkeeper'">
                        <mat-checkbox [disabled]="isDisabledGoalkeepers(player)" [checked]="isPlayerChecked(player)"
                          [id]="player.id" (change)="onChange($event,player)">
                          {{player.name}} {{player.surname}}</mat-checkbox>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
            </div>
            <mat-action-row>
              <button mat-button color="warn" type="button" (click)="prevStep()">Previous</button>
              <button mat-button color="primary" type="button" (click)="nextStep()">Next</button>
            </mat-action-row>
          </mat-expansion-panel>

          <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Команда соперника
              </mat-panel-title>
              <mat-panel-description>
                Заполните состав команды соперника
                <mat-icon>person</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div formGroupName='oponentData'>
              <!-- Форма выбора команды соперника -->
              <mat-form-field style="width: 218px">
                <input matInput placeholder="Введите команду соперника" formControlName='oponentTeam'
                  autocomplete="off">
              </mat-form-field>
              <div formArrayName='oponentPlayers'>
                <ng-container
                  *ngFor="let oponentPlayer of calendarForm.controls.oponentData.controls.oponentPlayers.controls; let i = index;">
                  <div [formGroupName]="i">
                    <mat-form-field style="width: 218px">
                      <input matInput placeholder="Введите имя игрока" [formControl]='oponentPlayer.controls["name"]'
                        autocomplete="off">
                    </mat-form-field>
                    <mat-form-field style="width: 218px">
                      <input matInput placeholder="Введите фамилию игрока"
                        [formControl]='oponentPlayer.controls["surname"]' autocomplete="off">
                    </mat-form-field>
                    <button mat-button type="button" (click)="removeOponent(i)">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                  </div>
                </ng-container>
              </div>
              <button mat-button [disabled]="calendarForm.value.oponentData.oponentTeam==''" type="button" (click)="addOponent()">
                <mat-icon>add_circle_outline</mat-icon>
              </button>
            </div>
            <mat-action-row>
              <button mat-button color="warn" type="button" (click)="prevStep()">Previous</button>
              <button mat-button color="primary" type="button" (click)="nextStep()">Next</button>
            </mat-action-row>
          </mat-expansion-panel>

          <mat-expansion-panel [disabled]="!isPastDate"  [expanded]="step === 3" (opened)="updatePlayersGoals()" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Протокол матча
              </mat-panel-title>
              <mat-panel-description>
                Заполните протокол матча
                <mat-icon>description</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div formGroupName='protocolData'>
              <!-- Форма выбора итогового счета матча -->
              <app-game-score-picker *ngIf="isPastDate" (onAddScore)="updateScore($event)" [inputScore]="inputScore">
              </app-game-score-picker>
              <div formArrayName='goals'>
                <ng-container
                  *ngFor="let goal of calendarForm.controls.protocolData.controls.goals.controls; let i = index;">
                  <div [formGroupName]="i">
                    <!-- Селектор для выбора игрока забившего гол -->
                    <mat-form-field style="width: 180px">
                      <mat-label>Игрок</mat-label>
                      <mat-select [formControl]='goal.controls["player"]' (selectionChange)="changePlayerGoal($event)">
                        <mat-option *ngFor="let playerGoal of playersGoals" [value]="playerGoal">
                          {{playerGoal.name}} {{playerGoal.surname}} {{playerGoal.autoGoal}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <!-- Время гола -->
                    <mat-form-field style="width: 120px">
                      <input matInput min="0" max="45" placeholder="Введите время" [formControl]='goal.controls["time"]'
                        autocomplete="off">
                    </mat-form-field>
                  </div>
                  <button mat-button (click)="addOponentGoal()" type="button">Кнопка</button>
                </ng-container>
              </div>
            </div>
            <mat-action-row>
              <button mat-button color="warn" type="button" (click)="prevStep()">Previous</button>
              <button mat-button color="primary" type="button" (click)="nextStep()">Next</button>
            </mat-action-row>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <div class="form-bottom" *ngIf="!id">
        <button mat-raised-button color="accent" type="submit">
          <mat-icon style="font-size: 20px">add_circle_outline</mat-icon> Добавить данные о матче
        </button>
      </div>

      <div class="form-bottom" *ngIf="id">
        <button mat-raised-button color="accent" type="submit">
          <mat-icon style="font-size: 20px">add_circle_outline</mat-icon> Сохранить изменения
        </button>
      </div>
    </div>
  </form>

</div>